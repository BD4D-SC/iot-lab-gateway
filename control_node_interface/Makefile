TARGET     = control_node_interface
CC         = gcc


# VERB = 1
quiet-cmd = $(if $(VERB),$1,$(if $(2),@echo $2 && $1, @$1))

WARNINGS  += -Wall -Wextra
WARNINGS  += -Wpointer-arith -Wbad-function-cast
WARNINGS  += -Wcast-align -Waggregate-return -Wmissing-prototypes
WARNINGS  += -Wmissing-declarations

#  COV        = -fprofile-arcs -ftest-coverage
#  PROF       = -pg
DEP_RULES  = -MMD -MD -MF $(OBJDIR)/$*.d


CFLAGS    += -std=c99 -g -O3 -fstrict-aliasing
CFLAGS    += $(WARNINGS) $(COV) $(PROF) $(DEP_RULES) $(LIBS) -pthread
LDFLAGS   += $(CFLAGS) -lpthread

SRCS       = $(wildcard $(SRCDIR)/*.c)
OBJS       = $(SRCS:$(SRCDIR)/%.c=$(OBJDIR)/%.o)
DEPS       = $(SRCS:.c=.d)

SRCDIR     = src
OBJDIR     = obj

.PHONY: all clean realclean run
.DEFAULT: all

all: $(OBJDIR) $(TARGET)

run: all
	./$(TARGET)

$(TARGET): $(OBJS)
	$(call quiet-cmd, $(CC) -o $@ $(LDFLAGS) $^,   "  LD      $@")

$(OBJDIR)/%.o : $(SRCDIR)/%.c Makefile
	$(call quiet-cmd, $(CC) -c $(CFLAGS) $< -o $@, "  CC      $@")

$(OBJDIR):
	$(call quiet-cmd, mkdir -p $(@),)



clean:
	rm -rf $(OBJS) $(DEPS)
realclean: clean
	rm -rf $(TARGET)
-include $(DEPS)

